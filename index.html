<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Explore Nepal ‚Äì Tourist Guide</title>
<meta name="description" content="Explore Nepal ‚Äî guide to mountains, lakes, parks, temples, tours, and travel tips." />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="manifest" href="/manifest.json">
<style>
  :root{
    --bg:#f6f8fb; --card:#ffffff; --primary:#0b67d0; --accent:#ff8c42; --muted:#6b7280; --glass:rgba(255,255,255,0.7);
    --radius:12px; --shadow: 0 6px 18px rgba(16,24,40,0.08);
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#0f1724;background:var(--bg);-webkit-font-smoothing:antialiased}
  .container{max-width:1200px;margin:0 auto;padding:20px}
  /* Header */
  header.site-header{position:sticky;top:0;z-index:200;background:linear-gradient(90deg,var(--primary),#0a8bf0);color:#fff;padding:10px 0;backdrop-filter:blur(6px)}
  .header-inner{display:flex;align-items:center;gap:14px;padding:6px 20px}
  .brand{display:flex;align-items:center;gap:10px}
  .brand img{width:44px;height:44px;border-radius:8px;object-fit:cover;border:2px solid rgba(255,255,255,0.12)}
  .brand h1{margin:0;font-size:1.05rem;font-weight:700}
  nav.main-nav{margin-left:auto;display:flex;gap:12px;align-items:center}
  nav.main-nav a{color:rgba(255,255,255,0.95);text-decoration:none;font-weight:600;padding:8px 10px;border-radius:8px}
  nav.main-nav a:hover{background:rgba(255,255,255,0.06)}
  .search{margin-left:16px}
  .search input{padding:8px 12px;border-radius:10px;border:none;width:260px;outline:none}
  .mobile-toggle{display:none;background:transparent;border:none;color:#fff;font-size:1.1rem}
  /* Hero */
  .hero{display:grid;grid-template-columns:1fr 420px;gap:20px;align-items:center;margin:20px 0}
  .hero-card{background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.85));padding:28px;border-radius:14px;box-shadow:var(--shadow);border:1px solid rgba(18,38,63,0.04)}
  .hero h2{margin:0 0 8px 0;font-size:1.6rem}
  .hero p{margin:0 0 14px 0;color:var(--muted)}
  .cta-row{display:flex;gap:10px}
  .btn{background:var(--primary);color:#fff;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;box-shadow:0 6px 12px rgba(11,103,208,0.12)}
  .btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(11,103,208,0.12);box-shadow:none}
  /* Filters */
  .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:14px 0;justify-content:center}
  .filter-btns{display:flex;gap:8px;flex-wrap:wrap}
  .filter-btns button{padding:8px 12px;border-radius:10px;border:1px solid rgba(15,23,36,0.06);background:#fff;cursor:pointer;font-weight:600}
  .filter-btns button.active{background:var(--accent);color:#fff;border-color:transparent}
  .sort-select{padding:8px;border-radius:10px;border:1px solid rgba(15,23,36,0.06);background:#fff}
  /* Grid */
  .destinations{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}
  .card{background:var(--card);border-radius:12px;border:1px solid rgba(12,20,30,0.04);overflow:hidden;display:flex;flex-direction:column;transition:transform .18s,box-shadow .18s;box-shadow:var(--shadow)}
  .card:hover{transform:translateY(-6px);box-shadow:0 18px 36px rgba(8,15,30,0.08)}
  .media{height:180px;position:relative;overflow:hidden}
  .media img{width:100%;height:100%;object-fit:cover;display:block}
  .card .info{padding:12px 14px;display:flex;flex-direction:column;gap:8px;flex:1}
  .meta{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .rating{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(90deg,#fff,rgba(255,255,255,0.9));padding:6px 8px;border-radius:999px;font-weight:700}
  .actions{display:flex;gap:8px}
  .btn.small{padding:8px 10px;font-size:.9rem;border-radius:8px}
  .btn.tertiary{background:#f3f4f6;color:#111;border:1px solid rgba(12,20,30,0.04)}
  /* Map & widgets */
  .map-container{height:420px;border-radius:12px;overflow:hidden;border:1px solid rgba(12,20,30,0.04);background:#e9eef8}
  .widgets{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  .widget{min-width:260px;padding:12px;border-radius:10px;border:1px solid rgba(12,20,30,0.04);background:#fff}
  /* itinerary */
  .itinerary{background:#fff;padding:12px;border-radius:10px;border:1px solid rgba(12,20,30,0.04)}
  .itinerary ol{padding-left:20px;margin:0}
  .itinerary .it-action{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:flex;align-items:center;justify-content:center;padding:18px;z-index:13000}
  .dialog{background:var(--card);border-radius:12px;padding:16px;max-width:760px;width:100%;max-height:85vh;overflow:auto;box-shadow:0 24px 60px rgba(2,6,23,0.4)}
  /* chat */
  #chat-box{position:fixed;right:18px;bottom:18px;width:360px;background:transparent;border-radius:12px;overflow:visible;z-index:14000}
  #chat-panel{background:linear-gradient(180deg,#fff,#fbfdff);border-radius:12px;overflow:hidden;border:1px solid rgba(12,20,30,0.06);box-shadow:var(--shadow)}
  #chat-header{display:flex;align-items:center;gap:10px;padding:10px 12px;background:linear-gradient(90deg,var(--primary),#0a8bf0);color:#fff;cursor:pointer;font-weight:700}
  #chat-header .status{font-size:.8rem;opacity:.95}
  #chat-messages{padding:12px;height:260px;overflow:auto;font-size:0.95rem;background:linear-gradient(180deg,rgba(250,252,255,0.9),transparent)}
  .msg{margin-bottom:10px;display:flex;gap:10px;align-items:flex-start}
  .msg.user{flex-direction:row-reverse}
  .msg .bubble{max-width:75%;padding:10px 12px;border-radius:12px;background:#f1f5f9;color:#0f1724}
  .msg.user .bubble{background:linear-gradient(90deg,var(--primary),#0a8bf0);color:#fff}
  .typing{display:inline-block;width:46px;height:18px;border-radius:12px;background:rgba(0,0,0,0.06);position:relative}
  .typing::before,.typing::after{content:'';position:absolute;left:8px;top:6px;width:6px;height:6px;border-radius:50%;background:#cbd5e1;animation:blink 1.2s infinite}
  .typing::after{left:22px;animation-delay:.2s}
  @keyframes blink{0%{opacity:.2}50%{opacity:1}100%{opacity:.2}}
  #chat-input{display:flex;border-top:1px solid rgba(12,20,30,0.04)}
  #chat-input input{flex:1;padding:10px;border:none;outline:none}
  #chat-input button{padding:10px 12px;border:none;background:var(--accent);color:#fff;border-radius:0 0 12px 0;cursor:pointer}
  /* footer */
  footer{background:#061026;color:#fff;padding:18px;text-align:center;margin-top:28px;border-radius:8px}
  .credits{font-size:.9rem;color:rgba(255,255,255,0.8)}
  /* responsiveness */
  @media (max-width:980px){ .hero{grid-template-columns:1fr} .search input{width:160px} }
  @media (max-width:720px){
    nav.main-nav{display:none}
    .mobile-toggle{display:inline-block}
    .search input{width:120px}
    .hero{grid-template-columns:1fr}
    #chat-box{right:12px;left:12px;width:auto}
  }
</style>
</head>
<body>
<header class="site-header" role="banner">
  <div class="header-inner container">
    <div class="brand" aria-hidden="false">
      <img src="/images/logo.png" alt="Explore Nepal logo" onerror="this.style.display='none'">
      <h1 id="site-title">Explore Nepal üá≥üáµ</h1>
    </div>

    <button class="mobile-toggle" aria-label="Open menu" id="mobile-toggle">‚ò∞</button>

    <div class="search" role="search" aria-label="Search places">
      <input id="global-search" placeholder="Search places, e.g. Pokhara, Everest..." aria-label="Search places" />
    </div>

    <nav class="main-nav" aria-label="Main navigation">
      <a href="#about">About</a>
      <a href="#places">Places</a>
      <a href="#tours">Tours</a>
      <a href="#map">Map</a>
      <a href="#faq">FAQ</a>
      <a href="#contact">Contact</a>
    </nav>

    <div style="margin-left:12px;display:flex;gap:8px;align-items:center">
      <button id="lang-toggle" class="btn ghost" aria-pressed="false">‡§®‡•á‡§™‡§æ‡§≤‡•Ä</button>
      <button id="view-favs" class="btn ghost" title="View favorites">‚òÖ <span id="fav-count">0</span></button>
    </div>
  </div>
</header>

<main class="container" role="main">

  <!-- HERO -->
  <section class="hero" aria-labelledby="hero-h">
    <div class="hero-card">
      <h2 id="hero-h">Plan your unforgettable trip to Nepal</h2>
      <p>Hand-picked places, verified photos, local tips, flexible itineraries and live weather. Start with curated destinations or create your own route.</p>
      <div class="cta-row">
        <button class="btn" id="start-explore">Explore top places</button>
        <button class="btn ghost" id="plan-trip">Create itinerary</button>
      </div>
      <div style="margin-top:12px;color:var(--muted);font-size:.95rem">
        <strong>Pro Tip:</strong> Use the search and filters. Click "Details" for official photos, weather, reviews and booking.
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:12px">
      <div class="widget" aria-live="polite" id="weather-widget">Loading weather‚Ä¶</div>
      <div class="widget">
        <h4 style="margin:0 0 8px 0">Currency Converter</h4>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <input id="cur-amount" type="number" value="1" style="padding:8px;width:80px">
          <select id="cur-from" style="padding:8px">
            <option value="USD">USD</option>
            <option value="NPR" selected>NPR</option>
            <option value="EUR">EUR</option>
          </select>
          <span>‚Üí</span>
          <select id="cur-to" style="padding:8px">
            <option value="NPR">NPR</option>
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
          </select>
          <button id="convert-btn" class="btn small">Convert</button>
        </div>
        <div id="convert-result" class="small" style="margin-top:8px;color:var(--muted)"></div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" aria-labelledby="about-h" style="margin-top:8px">
    <h2 id="about-h">Welcome to Nepal</h2>
    <p style="color:var(--muted)">Nepal is a land of dramatic landscapes, rich culture and incredible diversity. This guide helps tourists explore mountains, lakes, temples, parks and heritage sites with practical tips, verified photos and local contacts.</p>
  </section>

  <!-- CONTROLS -->
  <section style="margin-top:12px">
    <div class="controls">
      <div class="filter-btns" role="toolbar" aria-label="Filter places">
        <button class="active" data-filter="all">All</button>
        <button data-filter="mountains">Mountains</button>
        <button data-filter="lakes">Lakes</button>
        <button data-filter="temples">Temples</button>
        <button data-filter="heritage">Heritage</button>
        <button data-filter="wildlife">Wildlife</button>
      </div>

      <select id="sort-by" class="sort-select" aria-label="Sort places">
        <option value="recommended">Recommended</option>
        <option value="rating-desc">Rating: High ‚Üí Low</option>
        <option value="rating-asc">Rating: Low ‚Üí High</option>
        <option value="alpha">A ‚Üí Z</option>
      </select>

      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button id="export-itin" class="btn ghost">Export itinerary</button>
        <button class="btn" id="open-map">Open interactive map</button>
      </div>
    </div>
  </section>

  <!-- PLACES GRID -->
  <section id="places" aria-labelledby="places-h">
    <h2 id="places-h">Top Tourist Places</h2>

    <div class="destinations" id="destinations" aria-live="polite">

      <!-- Everest -->
      <article class="card" data-id="everest" data-category="mountains" data-lat="28.0043" data-lon="86.8576" draggable="true" aria-labelledby="everest-title">
        <div class="media">
          <!-- Prefer local high-quality images in /images/; fallback uses Unsplash. Replace /images/everest.jpg with your curated photo. -->
          <img src="/images/everest.jpg" alt="Mount Everest" loading="lazy"
               onerror="if(this.src.indexOf('images/everest.jpg')!=-1) this.src='https://images.unsplash.com/photo-1508264165352-cb0b5829d6ea?w=1200&auto=format&fit=crop&q=80'">
        </div>
        <div class="info">
          <h3 id="everest-title">Everest Base Camp</h3>
          <p style="margin:0;color:var(--muted)">Trek to the world‚Äôs highest peak region. Expect alpine scenery, teahouse stays and high-altitude acclimatisation.</p>
          <div class="meta">
            <div class="actions">
              <button class="btn small details-btn" data-id="everest">Details</button>
              <button class="btn tertiary small add-fav" data-id="everest">‚òÜ Fav</button>
              <button class="btn tertiary small add-itin" data-id="everest">Ôºã Itinerary</button>
            </div>
            <div class="rating" title="4.6 out of 5"><span>‚òÖ</span> <strong class="rating-value" data-id="everest">4.6</strong></div>
          </div>
        </div>
      </article>

      <!-- Phewa Lake -->
      <article class="card" data-id="phewa" data-category="lakes" data-lat="28.2096" data-lon="83.9856" draggable="true" aria-labelledby="phewa-title">
        <div class="media">
          <img src="/images/phewa.jpg" alt="Phewa Lake, Pokhara" loading="lazy"
               onerror="if(this.src.indexOf('images/phewa.jpg')!=-1) this.src='https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=1200&auto=format&fit=crop&q=80'">
        </div>
        <div class="info">
          <h3 id="phewa-title">Phewa Lake, Pokhara</h3>
          <p style="margin:0;color:var(--muted)">Boating, island temples and serene views of the Annapurna range. Great for sunrise and family activities.</p>
          <div class="meta">
            <div class="actions">
              <button class="btn small details-btn" data-id="phewa">Details</button>
              <button class="btn tertiary small add-fav" data-id="phewa">‚òÜ Fav</button>
              <button class="btn tertiary small add-itin" data-id="phewa">Ôºã Itinerary</button>
            </div>
            <div class="rating" title="4.4 out of 5"><span>‚òÖ</span> <strong class="rating-value" data-id="phewa">4.4</strong></div>
          </div>
        </div>
      </article>

      <!-- Pashupatinath -->
      <article class="card" data-id="pashupati" data-category="temples" data-lat="27.7100" data-lon="85.3488" draggable="true" aria-labelledby="pashupati-title">
        <div class="media">
          <img src="/images/pashupatinath.jpg" alt="Pashupatinath Temple" loading="lazy"
               onerror="if(this.src.indexOf('images/pashupatinath.jpg')!=-1) this.src='https://images.unsplash.com/photo-1531925470850-34f1b4b27f16?w=1200&auto=format&fit=crop&q=80'">
        </div>
        <div class="info">
          <h3 id="pashupati-title">Pashupatinath Temple</h3>
          <p style="margin:0;color:var(--muted)">One of Hinduism‚Äôs most important temples. Observe traditional rituals respectfully (wear appropriate clothing).</p>
          <div class="meta">
            <div class="actions">
              <button class="btn small details-btn" data-id="pashupati">Details</button>
              <button class="btn tertiary small add-fav" data-id="pashupati">‚òÜ Fav</button>
              <button class="btn tertiary small add-itin" data-id="pashupati">Ôºã Itinerary</button>
            </div>
            <div class="rating" title="4.2 out of 5"><span>‚òÖ</span> <strong class="rating-value" data-id="pashupati">4.2</strong></div>
          </div>
        </div>
      </article>

      <!-- Bhaktapur -->
      <article class="card" data-id="bhaktapur" data-category="heritage" data-lat="27.6726" data-lon="85.4270" draggable="true" aria-labelledby="bhaktapur-title">
        <div class="media">
          <img src="/images/bhaktapur.jpg" alt="Bhaktapur Durbar Square" loading="lazy"
               onerror="if(this.src.indexOf('images/bhaktapur.jpg')!=-1) this.src='https://images.unsplash.com/photo-1505765053275-76c2f4f7d3a0?w=1200&auto=format&fit=crop&q=80'">
        </div>
        <div class="info">
          <h3 id="bhaktapur-title">Bhaktapur Durbar Square</h3>
          <p style="margin:0;color:var(--muted)">Medieval city with traditional Newari architecture, pottery and courtyards. A photographer's delight.</p>
          <div class="meta">
            <div class="actions">
              <button class="btn small details-btn" data-id="bhaktapur">Details</button>
              <button class="btn tertiary small add-fav" data-id="bhaktapur">‚òÜ Fav</button>
              <button class="btn tertiary small add-itin" data-id="bhaktapur">Ôºã Itinerary</button>
            </div>
            <div class="rating" title="4.3 out of 5"><span>‚òÖ</span> <strong class="rating-value" data-id="bhaktapur">4.3</strong></div>
          </div>
        </div>
      </article>

      <!-- Chitwan -->
      <article class="card" data-id="chitwan" data-category="wildlife" data-lat="27.5389" data-lon="84.3542" draggable="true" aria-labelledby="chitwan-title">
        <div class="media">
          <img src="/images/chitwan.jpg" alt="Chitwan National Park" loading="lazy"
               onerror="if(this.src.indexOf('images/chitwan.jpg')!=-1) this.src='https://images.unsplash.com/photo-1519846850226-817a9a4b6d1e?w=1200&auto=format&fit=crop&q=80'">
        </div>
        <div class="info">
          <h3 id="chitwan-title">Chitwan National Park</h3>
          <p style="margin:0;color:var(--muted)">Jungle safaris, wildlife spotting, rhinos and birdwatching. Best with a licensed guide for safety and conservation.</p>
          <div class="meta">
            <div class="actions">
              <button class="btn small details-btn" data-id="chitwan">Details</button>
              <button class="btn tertiary small add-fav" data-id="chitwan">‚òÜ Fav</button>
              <button class="btn tertiary small add-itin" data-id="chitwan">Ôºã Itinerary</button>
            </div>
            <div class="rating" title="4.5 out of 5"><span>‚òÖ</span> <strong class="rating-value" data-id="chitwan">4.5</strong></div>
          </div>
        </div>
      </article>

    </div>
  </section>

  <!-- TOURS -->
  <section id="tours" aria-labelledby="tours-h" style="margin-top:18px">
    <h2 id="tours-h">Tour Packages</h2>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px">
      <div class="card" data-category="tour">
        <div class="media"><img src="/images/everest-trek.jpg" alt="Everest Trek" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=1200&auto=format&fit=crop&q=80'"></div>
        <div class="info">
          <h3>Everest Base Camp Trek ‚Äì 14 Days</h3>
          <p class="small" style="color:var(--muted)">Guide, permits, accommodation (tea-house) and meals. Difficulty: High.</p>
          <div style="margin-top:auto;text-align:right"><button class="btn book-btn" data-id="everest">Book Now</button></div>
        </div>
      </div>
      <div class="card" data-category="tour">
        <div class="media"><img src="/images/pokhara-tour.jpg" alt="Pokhara Tour" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1501854175958-1d4b2b0b0b99?w=1200&auto=format&fit=crop&q=80'"></div>
        <div class="info">
          <h3>Pokhara & Lakes Tour ‚Äì 3 Days</h3>
          <p class="small" style="color:var(--muted)">Boat rides, waterfalls and mountain scenery. Family friendly.</p>
          <div style="margin-top:auto;text-align:right"><button class="btn book-btn" data-id="pokhara">Book Now</button></div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAP + WIDGETS -->
  <section id="map" aria-labelledby="map-h" style="margin-top:18px">
    <h2 id="map-h">Explore Nepal Map</h2>
    <div class="map-container" id="map-frame" role="application" aria-label="Map of Nepal">
      <iframe
        loading="lazy"
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3539143.873320847!2d80.05813698782329!3d28.166035897137075!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1"
        width="100%" height="100%" style="border:0" allowfullscreen="" aria-hidden="false"></iframe>
    </div>

    <div class="widgets" style="margin-top:12px">
      <div class="widget">
        <h4 style="margin:0 0 8px 0">Plan ahead</h4>
        <p class="small" style="color:var(--muted);margin:0">Click a place's "Details" to see official photos, weather, reviews and easy booking. Use the search & filters to find places quickly. Drag cards to reorder your itinerary.</p>
      </div>
      <div class="widget">
        <h4 style="margin:0 0 8px 0">Nearby</h4>
        <p class="small" style="margin:0;color:var(--muted)">Use the "Locate me" feature to see attractions near your current location.</p>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="locate-me" class="btn small">Locate me</button>
          <button id="nearby-safari" class="btn ghost small">Nearby safaris</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ITINERARY -->
  <section id="itinerary" aria-labelledby="itinerary-h" style="margin-top:18px">
    <h2 id="itinerary-h">My Itinerary</h2>
    <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start;justify-content:space-between;margin-bottom:12px">
      <div class="itinerary" id="itinerary-box" style="min-width:320px">No items ‚Äî add places to build an itinerary. Reorder by dragging cards or using the controls inside the itinerary.</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="itinerary" style="min-width:240px">
          <div style="font-weight:700">Actions</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="print-itin" class="btn">Print</button>
            <button id="share-itin" class="btn ghost">Share</button>
            <button id="clear-itin" class="btn ghost" id="clear-itin">Clear</button>
          </div>
        </div>
        <div class="itinerary" style="min-width:240px">
          <div style="font-weight:700">Export</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="export-json" class="btn ghost small">Export JSON</button>
            <button id="export-ics" class="btn ghost small">Export .ics</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" aria-labelledby="faq-h" style="margin-top:18px">
    <h2 id="faq-h">FAQ & Emergency</h2>
    <div style="max-width:900px;margin:0 auto">
      <details><summary>How do I get permits for trekking?</summary><p class="small" style="color:var(--muted)">Popular treks require TIMS and national park permits; local agencies/trekking companies usually arrange these. Always confirm costs and inclusions in writing.</p></details>
      <details><summary>What is the best time to visit?</summary><p class="small" style="color:var(--muted)">Spring (Mar‚ÄìMay) and Autumn (Sep‚ÄìNov) are ideal for trekking and clear mountain views.</p></details>
      <details><summary>Emergency contacts</summary>
        <ul class="small" style="color:var(--muted)">
          <li>Police (Nepal): 100</li>
          <li>Ambulance: 102</li>
          <li>Tourist Police (Kathmandu): +977-1-425xxxx (example)</li>
        </ul>
      </details>
    </div>
  </section>

  <!-- CONTACT / NEWSLETTER -->
  <section id="contact" aria-labelledby="contact-h" style="margin-top:18px">
    <h2 id="contact-h">Contact & Social Media</h2>
    <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:12px">
      <a href="https://www.facebook.com/sanjay.subedi.963" target="_blank" rel="noopener" title="Facebook">üìò</a>
      <a href="https://www.instagram.com/sanjaysubedi2063/?__pwa=1" target="_blank" rel="noopener" title="Instagram">üì∏</a>
      <a href="mailto:info@example.com" title="Email">‚úâÔ∏è</a>
    </div>

    <div style="max-width:640px;margin:12px auto;background:#fff;padding:12px;border-radius:8px;border:1px solid rgba(12,20,30,0.04)">
      <h4 style="margin-top:0">Newsletter</h4>
      <form id="newsletter">
        <input type="email" id="newsletter-email" placeholder="Your email" required style="padding:8px;width:65%"> <button class="btn" type="submit">Subscribe</button>
        <p class="small" id="newsletter-msg" style="margin:8px 0 0 0;color:var(--muted)"></p>
      </form>
    </div>
  </section>

</main>

<footer>
  <div class="credits">¬© 2026 Explore Nepal ‚Ä¢ Designed by Sanjay Subedi ‚Ä¢ Built with local-first data ‚Äî add your photos to /images/ for verified visuals.</div>
</footer>

<!-- CHAT -->
<div id="chat-box" aria-live="polite" aria-label="Chat with guide">
  <div id="chat-panel">
    <div id="chat-header" role="button" aria-pressed="false">
      <span style="font-weight:800">Guide</span> <span class="status" id="chat-status">Online</span>
    </div>
    <div id="chat-messages" role="log" aria-live="polite" aria-relevant="additions"></div>
    <div id="chat-input">
      <input id="user-input" placeholder="Ask about places, weather or bookings..." aria-label="Chat input">
      <button id="send-btn" aria-label="Send message">Send</button>
    </div>
  </div>
</div>

<!-- Modal root -->
<div id="modal-root" aria-hidden="true" style="display:none;"></div>

<script>
/* ========= Utilities & Initialisation ========= */
(() => {
  // Small helper
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  // Language toggle: use data-en / data-ne attributes where available
  let currentLang = 'en';
  const langBtn = document.getElementById('lang-toggle');
  langBtn.addEventListener('click', () => {
    currentLang = currentLang === 'en' ? 'ne' : 'en';
    document.querySelectorAll('[data-en]').forEach(el => {
      if (currentLang === 'ne' && el.dataset.ne) el.textContent = el.dataset.ne;
      else el.textContent = el.dataset.en || el.textContent;
    });
    langBtn.textContent = currentLang === 'en' ? '‡§®‡•á‡§™‡§æ‡§≤‡•Ä' : 'English';
  });

  /* ========= Search & Filter ========= */
  const searchInput = document.getElementById('global-search');
  const destRoot = document.getElementById('destinations');

  function filterAndSearch() {
    const q = (searchInput.value || '').trim().toLowerCase();
    const active = document.querySelector('.filter-btns button.active')?.dataset.filter || 'all';
    const cards = $$(`#destinations .card`);
    cards.forEach(card => {
      const matchesFilter = active === 'all' || card.dataset.category === active;
      const text = (card.querySelector('h3')?.textContent || '') + ' ' + (card.querySelector('p')?.textContent || '');
      const matchesSearch = q === '' || text.toLowerCase().includes(q);
      card.style.display = matchesFilter && matchesSearch ? 'block' : 'none';
    });
  }
  searchInput.addEventListener('input', filterAndSearch);

  $$('.filter-btns button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      $$('.filter-btns button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      filterAndSearch();
    });
  });

  // Sorting
  document.getElementById('sort-by').addEventListener('change', (e)=>{
    const val = e.target.value;
    const parent = destRoot;
    const nodes = $$(`#destinations .card`).slice();
    nodes.sort((a,b)=>{
      const ra = parseFloat(a.querySelector('.rating-value')?.textContent||0);
      const rb = parseFloat(b.querySelector('.rating-value')?.textContent||0);
      const ta = a.querySelector('h3')?.textContent || '';
      const tb = b.querySelector('h3')?.textContent || '';
      if(val === 'rating-desc') return rb - ra;
      if(val === 'rating-asc') return ra - rb;
      if(val === 'alpha') return ta.localeCompare(tb);
      return 0; // recommended: leave as-is
    });
    nodes.forEach(n=>parent.appendChild(n));
  });

  /* ========= Favorites ========= */
  const favKey = 'explore_favs_v2';
  function loadFavs(){ return JSON.parse(localStorage.getItem(favKey)||'[]'); }
  function saveFavs(list){ localStorage.setItem(favKey, JSON.stringify(list)); updateFavUI(); }
  function toggleFav(id){
    const list = loadFavs();
    const idx = list.indexOf(id);
    if(idx >= 0) list.splice(idx,1); else list.push(id);
    saveFavs(list);
  }
  function updateFavUI(){
    const list = loadFavs();
    document.getElementById('fav-count').textContent = list.length;
    $$('.add-fav').forEach(btn => {
      const id = btn.dataset.id;
      btn.textContent = list.includes(id) ? '‚òÖ Fav' : '‚òÜ Fav';
    });
  }
  document.addEventListener('click', (e)=>{
    if(e.target.matches('.add-fav')) {
      const id = e.target.dataset.id;
      toggleFav(id);
      updateFavUI();
    }
    if(e.target.matches('#view-favs')) {
      const list = loadFavs();
      if(list.length === 0) return alert('No favorites yet.');
      const html = '<h3>Favorites</h3><ul>'+list.map(id=>{
        const card = document.querySelector(`.card[data-id="${id}"]`);
        return '<li>' + (card ? card.querySelector('h3').textContent : id) + '</li>';
      }).join('') + '</ul>';
      openModal(html);
    }
  });
  updateFavUI();

  /* ========= Itinerary (with reorder & exports) ========= */
  const itinKey = 'explore_itin_v2';
  function loadItin(){ return JSON.parse(localStorage.getItem(itinKey)||'[]'); }
  function saveItin(list){ localStorage.setItem(itinKey, JSON.stringify(list)); renderItin(); }
  function addToItin(id){
    const list = loadItin();
    if(!list.includes(id)) { list.push(id); saveItin(list); }
  }
  function clearItin(){ localStorage.removeItem(itinKey); renderItin(); }
  function renderItin(){
    const box = document.getElementById('itinerary-box');
    const list = loadItin();
    if(list.length===0){ box.innerHTML = 'No items ‚Äî add places to build an itinerary.'; return; }
    box.innerHTML = '<ol id="itin-list">'+list.map(id=>{
      const card = document.querySelector(`.card[data-id="${id}"]`);
      const title = card ? card.querySelector('h3').textContent : id;
      return `<li data-id="${id}" draggable="true"><span class="li-title">${title}</span>
               <div style="display:inline-flex;gap:8px;float:right">
                 <button class="btn ghost small move-up">‚Üë</button>
                 <button class="btn ghost small move-down">‚Üì</button>
                 <button class="btn ghost small remove-itin">Remove</button>
               </div>
             </li>`;
    }).join('')+'</ol>';
    attachItinHandlers();
  }

  function attachItinHandlers(){
    const listEl = document.getElementById('itin-list');
    if(!listEl) return;
    // drag & drop within itinerary to reorder
    let dragSrc = null;
    listEl.querySelectorAll('li').forEach(li => {
      li.addEventListener('dragstart', (ev)=>{
        dragSrc = li;
        ev.dataTransfer.effectAllowed = 'move';
        li.style.opacity = 0.4;
      });
      li.addEventListener('dragend', ()=> li.style.opacity = '');
      li.addEventListener('dragover', (ev)=>{ ev.preventDefault(); ev.dataTransfer.dropEffect = 'move'; });
      li.addEventListener('drop', (ev)=>{
        ev.preventDefault();
        if(!dragSrc || dragSrc === li) return;
        const items = loadItin();
        const srcId = dragSrc.dataset.id;
        const dstId = li.dataset.id;
        const srcIdx = items.indexOf(srcId);
        const dstIdx = items.indexOf(dstId);
        if(srcIdx < 0 || dstIdx < 0) return;
        items.splice(srcIdx,1);
        items.splice(dstIdx,0,srcId);
        saveItin(items);
      });
    });

    // move up/down/remove
    listEl.querySelectorAll('.move-up').forEach(btn => btn.addEventListener('click', (e)=>{
      const li = e.target.closest('li'); const id = li.dataset.id;
      const items = loadItin(); const idx = items.indexOf(id);
      if(idx > 0) { items.splice(idx,1); items.splice(idx-1,0,id); saveItin(items); }
    }));
    listEl.querySelectorAll('.move-down').forEach(btn => btn.addEventListener('click', (e)=>{
      const li = e.target.closest('li'); const id = li.dataset.id;
      const items = loadItin(); const idx = items.indexOf(id);
      if(idx >= 0 && idx < items.length-1) { items.splice(idx,1); items.splice(idx+1,0,id); saveItin(items); }
    }));
    listEl.querySelectorAll('.remove-itin').forEach(btn => btn.addEventListener('click', (e)=>{
      const id = e.target.closest('li').dataset.id;
      const items = loadItin(); const idx = items.indexOf(id);
      if(idx>=0) { items.splice(idx,1); saveItin(items); }
    }));
  }

  document.addEventListener('click', (e)=>{
    if(e.target.matches('.add-itin')) addToItin(e.target.dataset.id);
    if(e.target.matches('#clear-itin')) { if(confirm('Clear itinerary?')) clearItin(); }
    if(e.target.matches('#print-itin')) { window.print(); }
    if(e.target.matches('#share-itin')) {
      const list = loadItin();
      if(!navigator.share) return alert('Share not supported in this browser.');
      const text = list.map(id => {
        const card = document.querySelector(`.card[data-id="${id}"]`);
        return card ? card.querySelector('h3').textContent : id;
      }).join(', ');
      navigator.share({title:'My Nepal itinerary', text, url:location.href}).catch(()=>{});
    }
  });

  // exports
  document.getElementById('export-json').addEventListener('click', ()=>{
    const data = loadItin();
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'itinerary.json'; a.click(); URL.revokeObjectURL(url);
  });
  document.getElementById('export-ics').addEventListener('click', ()=>{
    const list = loadItin();
    if(!list.length) return alert('No items in itinerary.');
    // Simple ICS export with dates unspecified (user can set later)
    let ics = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//ExploreNepal//EN\n';
    list.forEach((id,idx)=>{
      const card = document.querySelector(`.card[data-id="${id}"]`);
      const title = card ? card.querySelector('h3').textContent : id;
      ics += 'BEGIN:VEVENT\nUID:' + (Date.now()+idx) + '@explorenepal\nSUMMARY:' + title + '\nEND:VEVENT\n';
    });
    ics += 'END:VCALENDAR';
    const blob = new Blob([ics], {type:'text/calendar'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'itinerary.ics'; a.click(); URL.revokeObjectURL(url);
  });

  // basic print/export/clear handlers
  document.getElementById('clear-itin').addEventListener('click', ()=>{ if(confirm('Clear itinerary?')) clearItin(); });

  renderItin();

  /* ========= Modal & Reviews & Booking ========= */
  const modalRoot = document.getElementById('modal-root');
  function openModal(inner){
    modalRoot.style.display='block'; modalRoot.setAttribute('aria-hidden','false');
    modalRoot.innerHTML = `<div class="modal" role="dialog" aria-modal="true"><div class="dialog">${inner}<div style="text-align:right;margin-top:12px"><button id="close-modal" class="btn ghost">Close</button></div></div></div>`;
    document.getElementById('close-modal').addEventListener('click', closeModal);
  }
  function closeModal(){ modalRoot.style.display='none'; modalRoot.innerHTML=''; modalRoot.setAttribute('aria-hidden','true'); }

  function loadReviews(id){ return JSON.parse(localStorage.getItem('reviews_'+id)||'[]'); }
  function addReview(id, rev){ const arr=loadReviews(id); arr.unshift(rev); localStorage.setItem('reviews_'+id, JSON.stringify(arr)); }

  // place details / booking
  document.addEventListener('click', async (e)=>{
    if(e.target.matches('.details-btn')){
      const id = e.target.dataset.id;
      const card = document.querySelector(`.card[data-id="${id}"]`);
      const title = card.querySelector('h3').textContent;
      const desc = card.querySelector('p').textContent;
      const lat = card.dataset.lat, lon = card.dataset.lon;
      const reviews = loadReviews(id);
      const reviewsHtml = reviews.length ? reviews.map(r=>`<div style="border-top:1px dashed #eee;padding-top:8px"><div style="color:gold">${'‚òÖ'.repeat(r.rating)}</div><div>${r.text}</div></div>`).join('') : '<div class="small" style="color:var(--muted)">No reviews yet.</div>';
      const galleryHtml = `<div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
        <img style="width:120px;height:80px;object-fit:cover;border-radius:8px" src="/images/${id}.jpg" alt="${title}" onerror="this.style.opacity=.6">
        <img style="width:120px;height:80px;object-fit:cover;border-radius:8px" src="/images/${id}-2.jpg" alt="${title} photo 2" onerror="this.style.opacity=.6">
        </div>`;
      const html = `<h3>${title}</h3><p style="color:var(--muted)">${desc}</p>${galleryHtml}<div id="detail-weather">Loading weather...</div><h4>Reviews</h4>${reviewsHtml}<h4>Leave a review</h4>
        <div><label>Rating</label><select id="review-rating"><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select></div>
        <div style="margin-top:8px"><textarea id="review-text" style="width:100%;height:80px" placeholder="Tell others what you liked..."></textarea></div>
        <div style="margin-top:8px;text-align:right"><button id="submit-review" class="btn">Submit review</button> <button id="book-from-modal" class="btn ghost" data-id="${id}">Book this</button></div>`;
      openModal(html);
      fetchWeatherFor(lat,lon, document.getElementById('detail-weather'));
      document.getElementById('submit-review').addEventListener('click', ()=>{
        const text = document.getElementById('review-text').value.trim();
        const rating = parseInt(document.getElementById('review-rating').value,10);
        if(!text) return alert('Please add a review message.');
        addReview(id, {rating, text, created:new Date().toISOString()});
        alert('Thanks ‚Äî your review was saved locally.');
        closeModal();
      });
      document.getElementById('book-from-modal').addEventListener('click', ev=>openBookingForm(ev.target.dataset.id));
    }

    if(e.target.matches('.book-btn') || e.target.matches('.book-btn *') || e.target.matches('#book-from-modal')){
      const id = e.target.dataset.id;
      openBookingForm(id);
    }
  });

  function openBookingForm(id){
    const card = document.querySelector(`.card[data-id="${id}"]`);
    const title = card ? card.querySelector('h3').textContent : id;
    const html = `<h3>Book: ${title}</h3>
      <form id="booking-form">
        <label style="display:block;margin-top:6px">Name</label><input id="bk-name" required style="width:100%;padding:8px;margin:6px 0">
        <label style="display:block">Email</label><input id="bk-email" type="email" required style="width:100%;padding:8px;margin:6px 0">
        <label style="display:block">Dates</label><input id="bk-dates" type="text" placeholder="e.g. 2026-03-12 to 2026-03-26" required style="width:100%;padding:8px;margin:6px 0">
        <div style="margin-top:8px;text-align:right"><button class="btn" type="submit">Send request</button></div>
      </form>`;
    openModal(html);
    document.getElementById('booking-form').addEventListener('submit', e=>{
      e.preventDefault();
      const name=document.getElementById('bk-name').value.trim();
      const email=document.getElementById('bk-email').value.trim();
      const dates=document.getElementById('bk-dates').value.trim();
      const bookings = JSON.parse(localStorage.getItem('bookings')||'[]');
      bookings.push({id,name,email,dates,created:new Date().toISOString()});
      localStorage.setItem('bookings',JSON.stringify(bookings));
      alert('Booking request saved locally. We will contact you at ' + email);
      closeModal();
    });
  }

  /* ========= Weather (Open-Meteo) ========= */
  async function fetchWeatherFor(lat, lon, target){
    if(!lat || !lon){ target.textContent = 'No coordinates available.'; return; }
    try{
      target.textContent = 'Loading weather...';
      const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
      const data = await res.json();
      if(data && data.current_weather){
        const w = data.current_weather;
        target.innerHTML = `<strong>Current:</strong> ${w.temperature}¬∞C, wind ${w.windspeed} km/h`;
      } else target.textContent = 'Weather data unavailable.';
    } catch(err){ target.textContent = 'Failed to load weather.'; }
  }
  // general weather for widget (Kathmandu)
  fetchWeatherFor(27.7172,85.3240, document.getElementById('weather-widget'));

  /* ========= Currency Converter (exchangerate.host) ========= */
  document.getElementById('convert-btn').addEventListener('click', async ()=>{
    const amount = Number(document.getElementById('cur-amount').value) || 1;
    const from = document.getElementById('cur-from').value;
    const to = document.getElementById('cur-to').value;
    const out = document.getElementById('convert-result');
    out.textContent = 'Converting‚Ä¶';
    try{
      const r = await fetch(`https://api.exchangerate.host/convert?from=${from}&to=${to}&amount=${amount}`);
      const data = await r.json();
      if(data && data.result !== undefined) out.textContent = `${amount} ${from} ‚âà ${data.result.toFixed(2)} ${to}`;
      else out.textContent = 'Conversion failed.';
    }catch(e){ out.textContent = 'Conversion failed.'; }
  });

  /* ========= Newsletter ========= */
  document.getElementById('newsletter').addEventListener('submit', e=>{
    e.preventDefault();
    const email = document.getElementById('newsletter-email').value;
    document.getElementById('newsletter-msg').textContent = 'Thanks! Subscribed: ' + email;
  });

  /* ========= Chat (improved local bot) ========= */
  const chatMessages = document.getElementById('chat-messages');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const chatStatus = document.getElementById('chat-status');
  function appendMsg(who, text, opts={}){
    const d = document.createElement('div'); d.className = 'msg ' + (who === 'You' ? 'user' : 'bot');
    const bubble = document.createElement('div'); bubble.className = 'bubble';
    if(text instanceof Node) bubble.appendChild(text); else bubble.textContent = text;
    d.appendChild(bubble);
    chatMessages.appendChild(d);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  function appendTyping(){
    const d = document.createElement('div'); d.className = 'msg bot typing-wrap';
    const bubble = document.createElement('div'); bubble.className = 'bubble';
    const t = document.createElement('span'); t.className = 'typing';
    bubble.appendChild(t);
    d.appendChild(bubble);
    chatMessages.appendChild(d);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return d;
  }
  function removeNode(node){ if(node && node.parentNode) node.parentNode.removeChild(node); }

  sendBtn.addEventListener('click', ()=>{ sendChat(); });
  userInput.addEventListener('keydown', e=>{ if(e.key === 'Enter') sendChat(); });

  async function sendChat(){
    const t = userInput.value.trim(); if(!t) return;
    appendMsg('You', t);
    userInput.value = '';
    chatStatus.textContent = 'Typing...';

    // Show typing indicator
    const typingNode = appendTyping();

    // Simple local NLU: intents for weather, book, itinerary, places, photo
    const low = t.toLowerCase();
    await new Promise(r => setTimeout(r, 700 + Math.random()*700)); // small delay to simulate thought

    let reply = "Hi ‚Äî I'm your local guide. Ask about places, weather, bookings or say 'suggest itinerary'.";
    if(/weather in|weather at|what.*weather|how's the weather|forecast/.test(low)) {
      // try find a place in the sentence
      const placeMatch = ['pokhara','everest','phewa','chitwan','bhaktapur','pashupati'].find(p => low.includes(p));
      if(placeMatch){
        // find card to get coords
        const card = document.querySelector(`.card[data-id*="${placeMatch}"]`);
        if(card) {
          const lat = card.dataset.lat, lon = card.dataset.lon;
          // fetch and give a short weather summary
          try{
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
            const data = await res.json();
            if(data && data.current_weather) {
              const w = data.current_weather;
              reply = `${card.querySelector('h3').textContent}: ${w.temperature}¬∞C, wind ${w.windspeed} km/h (source: Open-Meteo)`;
            } else reply = "Couldn't fetch weather for " + placeMatch;
          } catch(e){ reply = "Failed to fetch weather right now."; }
        } else reply = "Tell me the place name (e.g. Pokhara, Everest).";
      } else reply = "Which place? e.g. 'Weather in Pokhara' or 'Weather at Everest'.";
    } else if(/book|booking|reserve|reserve a spot/.test(low)) {
      // guide to booking
      const placeMatch = ['everest','pokhara','phewa','chitwan','bhaktapur','pashupati'].find(p => low.includes(p));
      if(placeMatch){ reply = `To book ${placeMatch}, click its "Book Now" button or say "book ${placeMatch}" and I will open the booking form.`; }
      else reply = 'Which place would you like to book? e.g. "book Pokhara tour"';
    } else if(/suggest|recommend|itinerary/.test(low)) {
      reply = 'Suggested 7-day itinerary: Day 1 Kathmandu (heritage), Day 2 Drive to Pokhara, Day 3 Phewa Lake & sunrise, Day 4 Pokhara to Chitwan (safari), Day 5 Jungle activities, Day 6 Travel back to Kathmandu, Day 7 Short city tour.';
    } else if(/photo|image|images|gallery/.test(low)) {
      reply = 'Open the "Details" for a place to see curated photos. You can also upload your images to /images/PLACEID.jpg to replace placeholders.';
    } else {
      // place-specific short answers
      if(/everest|base camp|sagarmatha/.test(low)) reply = 'Everest Base Camp trek is a high-altitude trek; allow at least 12‚Äì14 days and plan for acclimatisation.';
      else if(/pokhara|phewa/.test(low)) reply = 'Pokhara is ideal for lakeside relaxation, paragliding and as a gateway to Annapurna treks.';
      else if(/chitwan/.test(low)) reply = 'Chitwan National Park offers jeep and canoe safaris to spot rhinos, birds, and (rarely) tigers.';
    }

    // replace typing indicator with reply
    removeNode(typingNode);
    appendMsg('Guide', reply);
    chatStatus.textContent = 'Online';
  }

  // cosmetic: toggle chat collapse
  document.getElementById('chat-header').addEventListener('click', ()=>{
    const m = document.getElementById('chat-messages');
    const input = document.getElementById('chat-input');
    if(m.style.display === 'none') { m.style.display = 'block'; input.style.display = 'flex'; }
    else { m.style.display = 'none'; input.style.display = 'none'; }
  });

  /* ========= Locate me & nearby (basic) ========= */
  document.getElementById('locate-me').addEventListener('click', ()=>{
    if(!navigator.geolocation) return alert('Geolocation not supported.');
    navigator.geolocation.getCurrentPosition(pos=>{
      const {latitude,longitude} = pos.coords;
      window.open(`https://www.google.com/maps/search/attractions+near+me/@${latitude},${longitude},12z`, '_blank');
    }, ()=> alert('Location access denied.'));
  });

  /* ========= Service worker registration (PWA readiness) ========= */
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/service-worker.js').then(()=>console.log('SW registered')).catch(()=>console.log('SW registration failed'));
  }

  /* ========= Drag cards to itinerary (drag source from grid) ========= */
  // make cards draggable to itinerary
  $$('#destinations .card').forEach(card => {
    card.addEventListener('dragstart', (ev)=>{
      ev.dataTransfer.setData('text/plain', card.dataset.id);
    });
  });
  const itinBox = document.getElementById('itinerary-box');
  itinBox.addEventListener('dragover', (ev)=> ev.preventDefault());
  itinBox.addEventListener('drop', (ev)=>{
    ev.preventDefault();
    const id = ev.dataTransfer.getData('text/plain');
    if(id) addToItin(id);
  });

  /* ========= Misc UI actions ========= */
  document.getElementById('start-explore').addEventListener('click', ()=>{ location.href = '#places'; });
  document.getElementById('open-map').addEventListener('click', ()=>{ location.href = '#map'; });

  // initialize favorite visuals
  document.addEventListener('DOMContentLoaded', ()=>{
    updateFavUI();
    // set add-fav buttons initial state
    $$('.add-fav').forEach(btn => {
      const id = btn.dataset.id;
      btn.textContent = loadFavs().includes(id) ? '‚òÖ Fav' : '‚òÜ Fav';
    });
  });

  // Mobile toggle
  document.getElementById('mobile-toggle').addEventListener('click', ()=>{
    const nav = document.querySelector('nav.main-nav');
    if(nav.style.display === 'flex') nav.style.display = 'none';
    else nav.style.display = 'flex';
  });

  // Export itinerary summary
  document.getElementById('export-itin').addEventListener('click', ()=>{
    const list = loadItin();
    if(!list.length) return alert('No items in itinerary.');
    const text = list.map(id=>document.querySelector(`.card[data-id="${id}"]`)?.querySelector('h3')?.textContent || id).join('\n');
    const blob = new Blob([text], {type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'itinerary.txt'; a.click(); URL.revokeObjectURL(url);
  });

})();
</script>

</body>
</html>
